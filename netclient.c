#include <stdio.h>#include <stdlib.h>#include <errno.h>#include <strings.h>#include <sys/types.h>#include <sys/socket.h>#include <netinet/in.h>#include <netdb.h> #include <sys/time.h>#include <unistd.h>#include <string.h> #include <sys/stat.h>#include <sys/mman.h>#include <fcntl.h>#include <openssl/md5.h>#define BUF_SIZE 256unsigned static char * sheck_sum(char * );int main(int argc, char ** argv){    int sock, port;    struct sockaddr_in serv_addr;    struct hostent *server;    char buf[BUF_SIZE];    fd_set rfds;    struct timeval tv;    int retval;    FD_ZERO(&rfds);    unsigned char * result;    if (argc < 3)     {       fprintf(stderr,"usage: %s <hostname> <port_number>\n", argv[0]);       return EXIT_FAILURE;    }    port = atoi(argv[2]);    sock = socket(AF_INET, SOCK_STREAM, 0);    if (sock < 0)    {      printf("socket() failed: %d", errno);      return EXIT_FAILURE;    }    server = gethostbyname(argv[1]);    if (server == NULL)     {      printf("Host not found\n");      return EXIT_FAILURE;    }    memset((char *) &serv_addr, 0, sizeof(serv_addr));    serv_addr.sin_family = AF_INET;    strncpy((char *)&serv_addr.sin_addr.s_addr, (char *)server->h_addr_list[0], server->h_length);    serv_addr.sin_port = htons(port);    if (connect(sock, &serv_addr, sizeof(serv_addr)) < 0)     {      printf("connect() failed: %d", errno);      return EXIT_FAILURE;    }    printf(">");    memset(buf, 0, BUF_SIZE);  //  read(sock, buf, BUF_SIZE);    printf("answer MSG: %s\n", buf);    recv(sock, buf, BUF_SIZE, 0);       result = sheck_sum(buf);  //  for(int i=0; i <MD5_DIGEST_LENGTH; i++) {   //        printf("%02x",result[i]);   //                }    write(sock, result, MD5_DIGEST_LENGTH);         close(sock);    return 0;}// Print the MD5 sum as hex-digits.// Get the size of the file by its file descriptorunsigned static char * sheck_sum(char * file_name) {    int file_descript;    unsigned long file_size;    char* file_buffer;    unsigned static char result[16];    file_descript = open(file_name, O_RDONLY);    if(file_descript < 0) {        printf ("open error");         exit(-1);}    struct stat statbuf;    if(fstat(file_descript, &statbuf) < 0) exit(-1);    file_size = statbuf.st_size;    printf("file size:\t%lu\n", file_size);    file_buffer = mmap(NULL, file_size, PROT_READ, MAP_SHARED, file_descript, 0);    MD5((unsigned char*) file_buffer, file_size, result);    munmap(file_buffer, file_size);     close(file_descript);     for(int i=0; i <MD5_DIGEST_LENGTH; i++) {            printf("%02x",result[i]);    }    printf("  %s\n",file_name );    return result;}